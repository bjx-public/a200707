!function(){$(".popup-base .close, .popup-base .btn-base").click(function(){$(this).parents(".popup-base").parent("div").hide()}),$(".popup-base").dblclick(function(e){e.currentTarget===e.target&&$(this).parent("div").hide()}),$(".list .js-add").click(function(e){$(".popup-qrcode").show().data({mode:"add"}).find(".head").text("上传二维码").end().find("#area").val("").end().find("img").remove()}),$(".list .js-reload").click(function(e){var t=$(this).parents("tr"),a=t.data("id"),i=t.find("td"),t=i.eq(0).text(),i=i.eq(1).find("img").attr("src");$(".popup-qrcode").show().data({mode:"reload",id:a,area:t}).find(".head").text("重新上传二维码").end().find("#area").val(t).end().find("img").remove().end().find("label").before($('<img id="qr_b64">').attr("src",i))}),$(".popup-qrcode #upload").change(function(e){var t=this;picture_clip.init(e.target,300,388,function(e){$(t).parents("label").siblings("img").remove().end().before($('<img id="qr_b64">').attr("src",e))}),this.value=""}),$(".popup-qrcode .btn-main").click(function(){var e=$(".popup-qrcode").data();if("add"==e.mode){var t=[];$(".list tbody td:first-child").each(function(e){t.push($(this).text())});var a=new RegExp(t.join("|")||"##"),i=$("#area").val()||"",o=$("#qr_b64").attr("src")||"";if(!i)return void alert("请输入地域");if(i&&a.test(i))return void alert("地域重复");if(!/data:image/.test(o))return void alert("请选择二维码");var r="/api/wechat_group/submit/?action=add",n={sid:+$(".list h2").data("id"),area:i,qr_b64:o};console.log(n)}else if("reload"==e.mode){t=[];$(".list tbody td:first-child").each(function(e){t.push($(this).text())});var d=t.indexOf(e.area);-1!==d&&t.splice(d,1);a=new RegExp(t.join("|")||"##"),i=$("#area").val()||"",o=$("#qr_b64").attr("src")||"";if(!i)return void alert("请输入地域");if(i&&a.test(i))return void alert("地域重复");if(/^\//.test(o)&&i==e.area)return void alert("无变更");r="/api/wechat_group/submit/?action=mod",n={};n=i==e.area?{id:e.id,area:"",qr_b64:o}:/^\//.test(o)?{id:e.id,area:i,qr_b64:""}:{id:e.id,area:i,qr_b64:o},console.log(n)}$.ajax({url:r,type:"POST",data:JSON.stringify(n),processData:!1,contentType:"application/json",cache:!1}).done(function(e){$(".popup-qrcode").hide(),1===e.status?location.reload():(console.log(e),alert(e.message))})}),$(".list .js-del").click(function(e){var t;confirm("确定删除该条目？")&&(t=$(this).parents("tr").data("id"),$.ajax({url:"/api/wechat_group/submit/?action=del",type:"POST",data:JSON.stringify({id:t}),processData:!1,contentType:"application/json",cache:!1}).done(function(e){$(".popup-qrcode").hide(),1===e.status?location.reload():(console.log(e),alert(e.message))}))}),$(".list .js-revalid").click(function(e){var t;confirm("确定重新生效该条目？")&&(t=$(this).parents("tr").data("id"),$.ajax({url:"/api/wxq_qr_invalid/",type:"GET",data:{id:t,reverse:1},cache:!1}).done(function(e){$(".popup-qrcode").hide(),1===e.status?location.reload():(console.log(e),alert(e.message))}))});var r=$("");$(".list").on("mouseenter","img",function(e){var t=this.getBoundingClientRect(),a=t.top,i=t.left+100,o=document.documentElement.clientHeight;t.top>o/3*2?a-=330:t.top>o/3&&(a-=165),r=$("<img>").attr("src",this.src).css({position:"fixed","z-index":998,top:a,left:i,padding:"6px",background:"#666","border-radius":"6px"}),$("body").append(r)}).on("mouseleave","img",function(e){r.remove()})}();
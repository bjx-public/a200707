!function(a){document.addEventListener("DOMContentLoaded",function(){var a='#picture_clip {display:none;}.picture-clip{position:fixed;top:0;left:0;z-index:1999;width:100%;height:100%;background:rgba(0,0,0,.5);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;font-family: "Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",Arial,sans-serif}.picture-clip-box{position:relative;width:600px;background:#fff;border-radius:6px;color:#333;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.picture-clip a{color:inherit;text-decoration:none}.picture-clip .title{height:55px;line-height:55px;padding:0 5px 0 15px;border-bottom:1px solid #ccc}.picture-clip .title span{font-size:18px}.picture-clip .title a{float:right;font-size:26px;font-weight:bold;padding:0 10px;color:#666}.picture-clip .button{height:55px;line-height:55px;padding:0 15px;border-top:1px solid #ccc;text-align:right}.picture-clip .button a{padding:6px 12px;border-radius:4px;font-size:14px;margin:0 3px 0 10px;border:1px solid #ccc;background:#fff;color:#333}.picture-clip .button a:hover{background:#f3f3f3}.picture-clip .button a.continue{border:1px solid #f40;background:#f40;color:#fff}.picture-clip .button a.continue:hover{background:#d63900}.picture-clip .zoom{text-align:center;height:60px;line-height:60px}.picture-clip .zoom a{display:inline-block;vertical-align:top;font-size:44px;color:#666;cursor:pointer}.picture-clip .zoom .horizontal{display:inline-block;vertical-align:top;position:relative;top:29px}.picture-clip .zoom .horizontal .line{height:5px;width:300px;background:#d9d9d9;border-radius:2px;cursor:pointer}.picture-clip .zoom .horizontal .thumb{height:14px;width:14px;background:#9f9f9f;border-radius:7px;position:absolute;left:0;top:-5px;cursor:pointer}.picture-clip .box{width:260px;height:260px;margin:20px auto 0 auto;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCQkVGRjg5MTU4QkIxMUU4ODk1RkE2RUFEQ0FCMDFFNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCQkVGRjg5MjU4QkIxMUU4ODk1RkE2RUFEQ0FCMDFFNCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkJCRUZGODhGNThCQjExRTg4OTVGQTZFQURDQUIwMUU0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkJCRUZGODkwNThCQjExRTg4OTVGQTZFQURDQUIwMUU0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+VxH1nAAAACpJREFUeNpi+f//PwM2cPbsWaziTAwkglENxAAWXOFtbGw8Gkr00wAQYAADAwiJ05pkSgAAAABJRU5ErkJggg==");overflow:hidden;position:relative}.picture-clip .box .shade{position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;width:100%;height:100%;border:30px solid rgba(255,255,255,.6);-webkit-box-shadow:0 0 15px rgba(0,0,0,.6) inset;box-shadow:0 0 15px rgba(0,0,0,.6) inset;cursor:move}.picture-clip .box img{position:absolute;top:30px;left:30px}',b='<div id="picture_clip"><div class="picture-clip"><div class="picture-clip-box"><div class="title"><span>&#32534;&#36753;&#22270;&#29255;</span><a class="cancel" title="&#20851;&#38381;">&#215;</a></div><div class="box"><img src=""><div class="shade" title="&#25302;&#21160;&#22270;&#29255;"></div></div><div class="zoom"><a class="zoomOut" title="&#32553;&#23567;">&#65123;</a><div class="horizontal"><div class="line"></div><div class="thumb" title="&#32553;&#25918;"></div></div><a class="zoomIn" title="&#25918;&#22823;">&#65122;</a></div><div class="button"><a class="continue">&#30830;&#23450;</a><a class="cancel">&#21462;&#28040;</a></div></div></div></div>',c=document.createElement("style"),d=document.createElement("div");document.querySelector("head").appendChild(c),document.querySelector("body").appendChild(d),c.innerHTML=a,d.innerHTML=b}),a.picture_clip={boxGap:30,boxMin:240,boxMax:400,init:function(a,b,c,d,e){var f,g,h,i;if(void 0!==a&&void 0!==b&&void 0!==c&&void 0!==d){if(!a.files)return alert("\u4ec5\u652f\u6301\u0049\u0045\u0031\u0030\u53ca\u4ee5\u4e0a\u6d4f\u89c8\u5668"),void 0;this.el=a,this.wantW=b,this.wantH=c,this.cb=d,this.mode=e||!1,this.saved=0,f=this.boxMin,g=this.boxMax,h=2*this.boxGap,b>=f-h&&g-h>=b&&c>=f-h&&g-h>=c?(this.boxW=b+h,this.boxH=c+h):(i=b/c,i>1?f-h>b?(this.boxW=f,this.boxH=(f-h)*c/b+h):b>g-h&&(this.boxW=g,this.boxH=(g-h)*c/b+h):1>i?f-h>c?(this.boxH=f,this.boxW=(f-h)*b/c+h):c>g-h&&(this.boxH=g,this.boxW=(g-h)*b/c+h):f-h>c?(this.boxH=f,this.boxW=f):c>g-h&&(this.boxH=g,this.boxW=g)),this.run()}},run:function(){var a=this,b=this.el.files[0];this.getImgBase64(b,function(b){var d,e,f,g,h,i,j,k,l,m,c=new Image;c.onload=function(){var b,d,e,f,g,h,i,j,k,l,m,n,o,p;a.originW=c.width,a.originH=c.height,b=a.boxW/a.boxH,d=a.originW/a.originH,a.mode?b>d?(j=a.boxW-2*a.boxGap,l=j/a.originW,f=a.boxH-2*a.boxGap,g=f/a.originH,e=a.originW*g,h=a.boxGap,i=(a.boxW-e)/2):d>=b&&(k=a.boxH-2*a.boxGap,l=k/a.originH,e=a.boxW-2*a.boxGap,g=e/a.originW,f=a.originH*g,h=(a.boxH-f)/2,i=a.boxGap):b>d?(e=a.boxW-2*a.boxGap,g=e/a.originW,f=a.originH*g,h=(a.boxH-f)/2,i=a.boxGap):d>=b&&(f=a.boxH-2*a.boxGap,g=f/a.originH,e=a.originW*g,h=a.boxGap,i=(a.boxW-e)/2),a.tileZoom=l,a.initZoom=g,a.zoom=g,c.style.width=e+"px",c.style.height=f+"px",c.style.top=h+"px",c.style.left=i+"px",m=document.querySelector(".picture-clip .box"),n=document.querySelector(".picture-clip .box img"),o=document.querySelector(".picture-clip .box .shade"),p=document.querySelector(".picture-clip .zoom .thumb"),n.parentNode.removeChild(n),m.style.width=a.boxW+"px",m.style.height=a.boxH+"px",m.insertBefore(c,m.childNodes[0]),o.style.borderWidth=a.boxGap+"px",p.style.left=0,document.querySelector("#picture_clip").style.display="block"},c.src=b,d=function(){var b,c,d,e,f,g;a.initZoom>1||(b=document.querySelector(".picture-clip .zoom .line"),c=document.querySelector(".picture-clip .zoom .thumb"),d=b.clientWidth-c.clientWidth,e=parseFloat(c.style.left),f=e+d/10>=d?d:e+d/10,c.style.left=f+"px",g=a.zoom+(1-a.initZoom)/10,a.zoom=g>=1?1:g,a.zoomFun())},e=function(){var b,c,d,e,f,g;a.initZoom>1||(b=document.querySelector(".picture-clip .zoom .line"),c=document.querySelector(".picture-clip .zoom .thumb"),d=b.clientWidth-c.clientWidth,e=parseFloat(c.style.left),f=0>e-d/10?0:e-d/10,c.style.left=f+"px",g=a.zoom-(1-a.initZoom)/10,a.zoom=g<=a.initZoom?a.initZoom:g,a.zoomFun())},f=function(b){var c,d,e,f;a.initZoom>1||(c=document.querySelector(".picture-clip .zoom .thumb"),d=this.clientWidth-c.clientWidth,e=b.offsetX,f=e-c.clientWidth/2,e>=d?f=d:e<=c.clientWidth/2&&(f=0),c.style.left=f+"px",a.zoom=a.initZoom+(1-a.initZoom)*(f/d),a.zoomFun())},g=function(){a.thumbMoveing=1},h=function(){a.imgMoveing=1},i=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;a.thumbMoveing&&a.lastPosition&&a.initZoom<=1&&(c=document.querySelector(".picture-clip .zoom .line"),d=document.querySelector(".picture-clip .zoom .thumb"),e=c.clientWidth-d.clientWidth,f=parseFloat(d.style.left),g=f+(b.pageX-a.lastPosition.x),g>=e?g=e:0>=g&&(g=0),d.style.left=g+"px",a.zoom=a.initZoom+(1-a.initZoom)*(g/e),a.zoomFun()),a.imgMoveing&&a.lastPosition&&(h=document.querySelector(".picture-clip .box img"),i=parseFloat(h.style.left),j=parseFloat(h.style.top),k=i+(b.pageX-a.lastPosition.x),l=j+(b.pageY-a.lastPosition.y),!a.mode||a.zoom>a.tileZoom?(m=a.boxGap,n=-(parseFloat(h.clientWidth)-(a.boxW-a.boxGap)),o=a.boxGap,p=-(parseFloat(h.clientHeight)-(a.boxH-a.boxGap))):(q=a.boxW/a.boxH,r=a.originW/a.originH,q>r?(m=a.boxW-(parseFloat(h.clientWidth)+a.boxGap),n=a.boxGap,o=a.boxGap,p=-(parseFloat(h.clientHeight)-(a.boxH-a.boxGap))):r>=q&&(m=a.boxGap,n=-(parseFloat(h.clientWidth)-(a.boxW-a.boxGap)),o=a.boxH-(parseFloat(h.clientHeight)+a.boxGap),p=a.boxGap)),k>=m?k=m:n>=k&&(k=n),l>=o?l=o:p>=l&&(l=p),h.style.left=k.toFixed(3)+"px",h.style.top=l.toFixed(3)+"px"),a.lastPosition={x:b.pageX,y:b.pageY}},j=function(){a.thumbMoveing=0,a.imgMoveing=0},k=function(){document.querySelector(".picture-clip .zoomIn").removeEventListener("click",d),document.querySelector(".picture-clip .zoomOut").removeEventListener("click",e),document.querySelector(".picture-clip .line").removeEventListener("click",f),document.querySelector(".picture-clip .thumb").removeEventListener("mousedown",g),document.querySelector(".picture-clip .shade").removeEventListener("mousedown",h),document.querySelector(".picture-clip").removeEventListener("mousemove",i),document.documentElement.removeEventListener("mouseup",j),document.querySelector(".picture-clip .button .continue").removeEventListener("click",l),document.querySelector(".picture-clip .button .cancel").removeEventListener("click",m),document.querySelector(".picture-clip .title .cancel").removeEventListener("click",m)},l=function(){a.saved||(a.cb(a.saveFun()),a.saved=1),document.querySelector("#picture_clip").style.display="none",k()},m=function(){document.querySelector("#picture_clip").style.display="none",k()},document.querySelector(".picture-clip .zoomIn").addEventListener("click",d),document.querySelector(".picture-clip .zoomOut").addEventListener("click",e),document.querySelector(".picture-clip .line").addEventListener("click",f),document.querySelector(".picture-clip .thumb").addEventListener("mousedown",g),document.querySelector(".picture-clip .shade").addEventListener("mousedown",h),document.querySelector(".picture-clip").addEventListener("mousemove",i),document.documentElement.addEventListener("mouseup",j),document.querySelector(".picture-clip .button .continue").addEventListener("click",l),document.querySelector(".picture-clip .button .cancel").addEventListener("click",m),document.querySelector(".picture-clip .title .cancel").addEventListener("click",m)})},getImgBase64:function(a,b){if(window.FileReader){var c=new FileReader;c.onload=function(){b&&b(c.result)},c.readAsDataURL(a)}},zoomFun:function(){var j,k,l,m,n,o,a=document.querySelector(".picture-clip .box img"),b=parseFloat(a.clientWidth),c=parseFloat(a.clientHeight),d=parseFloat(a.style.left),e=parseFloat(a.style.top),f=this.originW*this.zoom,g=this.originH*this.zoom,h=d-(f-b)/2,i=e-(g-c)/2;this.mode?(n=this.boxW/this.boxH,o=this.originW/this.originH,n>o?(j=(this.boxW-this.originW*this.initZoom)/2,k=(this.boxW-this.originW)/2,l=this.boxGap,m=(this.boxH-this.originH)/2):o>=n&&(j=this.boxGap,k=(this.boxW-this.originW)/2,l=(this.boxH-this.originH*this.initZoom)/2,m=(this.boxH-this.originH)/2)):(j=this.boxGap,k=-(f-(this.boxW-this.boxGap)),l=this.boxGap,m=-(g-(this.boxH-this.boxGap))),h>=j?h=j:k>=h&&(h=k),i>=l?i=l:m>=i&&(i=m),a.style.width=f.toFixed(3)+"px",a.style.height=g.toFixed(3)+"px",a.style.left=h.toFixed(3)+"px",a.style.top=i.toFixed(3)+"px"},saveFun:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,a=document.createElement("canvas");return a.width=this.wantW,a.height=this.wantH,b=document.querySelector(".picture-clip .box img"),!this.mode||this.zoom>this.tileZoom?(c=Math.abs((parseFloat(b.style.left)-this.boxGap)/this.zoom),d=Math.abs((parseFloat(b.style.top)-this.boxGap)/this.zoom),e=(this.boxW-2*this.boxGap)/this.zoom,f=(this.boxH-2*this.boxGap)/this.zoom,g=0,h=0,i=this.wantW,j=this.wantH):(k=this.boxW/this.boxH,l=this.originW/this.originH,m=parseFloat(b.style.left)-this.boxGap,n=parseFloat(b.style.top)-this.boxGap,k>l?(0>n?(d=Math.abs(n)/this.zoom,h=0):(d=0,h=0),f=(this.boxH-2*this.boxGap)/this.zoom,j=this.wantH,c=0,g=m/(this.boxW-2*this.boxGap)*this.wantW,e=this.originW,i=this.originW*this.zoom/(this.boxW-2*this.boxGap)*this.wantW):l>=k&&(0>m?(c=Math.abs(m)/this.zoom,g=0):(c=0,g=0),e=(this.boxW-2*this.boxGap)/this.zoom,i=this.wantW,d=0,h=n/(this.boxH-2*this.boxGap)*this.wantH,f=this.originH,j=this.originH*this.zoom/(this.boxH-2*this.boxGap)*this.wantH)),o=a.getContext("2d"),o.fillStyle="#FFFFFF",o.fillRect(0,0,this.wantW,this.wantH),o.drawImage(b,c,d,e,f,g,h,i,j),a.toDataURL("image/jpeg",.8)}}}(this);